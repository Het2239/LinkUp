<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail Formats - Student Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Poppins', sans-serif;
        }
        .auth-container {
            background: linear-gradient(135deg, #6366f1 0%, #3b82f6 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        :root {
            color-scheme: light dark;
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        .mail-template-card {
            transition: all 0.3s ease;
        }
        .mail-template-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .template-category {
            transition: all 0.2s ease;
        }
        .template-category:hover {
            background-color: rgba(99, 102, 241, 0.1);
        }
        .template-category.active {
            border-color: #6366f1;
            background-color: rgba(99, 102, 241, 0.1);
        }
        #homepage {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- Auth Container -->
    <div id="authPage" class="auth-container min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect w-full max-w-md p-8 rounded-2xl shadow-xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">Student Companion</h1>
                <p class="text-gray-200">Your college life, simplified.</p>
            </div>

            <!-- Auth Tabs -->
            <div class="mb-6">
                <div class="flex space-x-2 mb-6">
                    <button onclick="switchTab('login')" class="flex-1 py-2 px-4 rounded-lg bg-white bg-opacity-20 text-white hover:bg-opacity-30 transition" id="loginTab">Student Login</button>
                    <button onclick="switchTab('admin')" class="flex-1 py-2 px-4 rounded-lg bg-white bg-opacity-20 text-white hover:bg-opacity-30 transition" id="adminTab">Admin Login</button>
                    <button onclick="switchTab('register')" class="flex-1 py-2 px-4 rounded-lg bg-white bg-opacity-20 text-white hover:bg-opacity-30 transition" id="registerTab">Register</button>
                </div>

                <!-- Login Form -->
                <form id="loginForm" class="space-y-4" onsubmit="handleLogin(event)">
                    <div>
                        <input type="email" id="loginEmail" placeholder="Email" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <div>
                        <input type="password" id="loginPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <button type="submit" class="w-full py-3 rounded-lg bg-white text-indigo-600 font-semibold hover:bg-opacity-90 transition">Login</button>
                </form>

                <!-- Admin Form -->
                <form id="adminForm" class="space-y-4 hidden" onsubmit="handleAdminLogin(event)">
                    <div>
                        <input type="password" id="adminPassword" placeholder="Admin Password" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <button type="submit" class="w-full py-3 rounded-lg bg-white text-indigo-600 font-semibold hover:bg-opacity-90 transition">Admin Login</button>
                </form>

                <!-- Register Form -->
                <form id="registerForm" class="space-y-4 hidden" onsubmit="handleRegister(event)">
                    <div>
                        <input type="text" id="registerName" placeholder="Full Name" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <div>
                        <input type="email" id="registerEmail" placeholder="College Email" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <div>
                        <input type="password" id="registerPassword" placeholder="Create Password" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <div>
                        <input type="password" id="confirmPassword" placeholder="Confirm Password" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 outline-none" required>
                    </div>
                    <button type="submit" class="w-full py-3 rounded-lg bg-white text-indigo-600 font-semibold hover:bg-opacity-90 transition">Register</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Homepage with Navbar -->
    <div id="homepage" class="min-h-screen bg-gray-50 dark:bg-gray-900">
        <!-- Navbar -->
        <nav class="bg-indigo-600 text-white shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold">Student Companion</h1>
                        <span id="welcomeMessage" class="hidden md:inline text-sm">Welcome, <span id="userName">User</span>!</span>
                    </div>
                    
                    <div class="flex items-center">
                        <button id="logoutBtn" class="py-1 px-2 md:py-2 md:px-4 text-xs md:text-base rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-indigo-700 text-white">
            <div class="container mx-auto px-4 py-2">
                <button class="w-full text-left py-2 px-4 hover:bg-indigo-600 rounded-lg" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Sidebar Navigation -->
        <div class="flex flex-col md:flex-row">
            <!-- Sidebar -->
            <div id="sidebar" class="fixed md:relative w-64 bg-indigo-800 text-white h-screen z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
                <div class="p-4">
                    <h2 class="text-xl font-semibold mb-4">Features</h2>
                    <ul class="space-y-2">
                        <li><a href="notice.html" class="block py-2 px-4 rounded-lg nav-link">Notice Board</a></li>
                        <li><a href="taxi-search.html" class="block py-2 px-4 rounded-lg nav-link">Taxi Search</a></li>
                        <li><a href="study.html" class="block py-2 px-4 rounded-lg nav-link">Study Materials</a></li>
                        <li><a href="#" class="block py-2 px-4 rounded-lg nav-link bg-white bg-opacity-20">Mail Formats</a></li>
                        <li><a href="kyp.html" class="block py-2 px-4 rounded-lg nav-link">Know Your People</a></li>
                        <li><a href="outings.html" class="block py-2 px-4 rounded-lg nav-link">Outings & Trips</a></li>
                        <li><a href="messmenu.html" class="block py-2 px-4 rounded-lg nav-link">Mess & Canteen</a></li>
                    </ul>
                </div>
            </div>

            <div class="fixed bottom-4 left-4 z-40 md:hidden">
                <button onclick="toggleSidebar()" class="bg-indigo-600 text-white p-3 rounded-full shadow-lg">
                    <i class="bi bi-list text-xl"></i>
                </button>
            </div>

            <!-- Main Content -->
            <div class="flex-1 p-4 md:p-8">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 md:p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Mail Formats</h2>
                        <div id="adminControls" class="hidden">
                            <button onclick="showAddTemplateModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition flex items-center">
                                <i class="bi bi-plus-lg mr-2"></i> Add New Template
                            </button>
                        </div>
                    </div>

                    <!-- Categories Section -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Categories</h3>
                        <div class="flex flex-wrap gap-2" id="categoriesContainer">
                            <button onclick="filterTemplates('all')" class="template-category active px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium">All</button>
                            <!-- Categories will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Searc bar -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search templates..." class="w-full p-3 pr-10 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 outline-none border border-gray-300 dark:border-gray-600" oninput="searchTemplates()">
                            <i class="bi bi-search absolute right-3 top-3 text-gray-500 dark:text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Mail Templates Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="mailTemplatesContainer">
                        <!-- Templates will be dynamically added here -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="hidden text-center py-10">
                        <i class="bi bi-envelope-x text-5xl text-gray-400 dark:text-gray-600 mb-3"></i>
                        <h3 class="text-xl font-medium text-gray-700 dark:text-gray-300">No templates found</h3>
                        <p class="text-gray-500 dark:text-gray-400 mt-1">Try adjusting your search or category filter</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Template View Modal -->
    <div id="viewTemplateModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white" id="viewTemplateTitle">Template Title</h3>
                    <button onclick="closeViewModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="mb-3">
                    <span class="inline-block bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-300 text-xs px-2 py-1 rounded-full" id="viewTemplateCategory">Category</span>
                </div>
                <div class="mb-6">
                    <p class="text-sm text-gray-500 dark:text-gray-400" id="viewTemplateDescription">Description</p>
                </div>
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-6">
                    <pre class="text-gray-800 dark:text-white whitespace-pre-wrap font-sans" id="viewTemplateContent">Email content will be displayed here</pre>
                </div>
                <div id="viewTemplateAdminControls" class="flex justify-end gap-3 hidden">
                    <button onclick="showEditModal()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
                        <i class="bi bi-pencil mr-1"></i> Edit
                    </button>
                    <button onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition">
                        <i class="bi bi-trash mr-1"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Template Modal -->
    <div id="editTemplateModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white" id="editModalTitle">Add New Template</h3>
                    <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <form id="templateForm" onsubmit="saveTemplate(event)">
                    <input type="hidden" id="templateId">
                    <div class="mb-4">
                        <label for="templateTitle" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
                        <input type="text" id="templateTitle" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white border border-gray-300 dark:border-gray-600 outline-none" required>
                    </div>
                    <div class="mb-4">
                        <label for="templateCategory" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                        <div class="flex gap-2">
                            <input type="text" id="templateCategory" class="flex-1 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white border border-gray-300 dark:border-gray-600 outline-none" required>
                            <select id="categoryDropdown" class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white border border-gray-300 dark:border-gray-600 outline-none" onchange="selectExistingCategory()">
                                <option value="">Select existing</option>
                                <!-- Existing categories will be added here -->
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="templateDescription" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="templateDescription" rows="2" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white border border-gray-300 dark:border-gray-600 outline-none" required></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="templateContent" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email Content</label>
                        <textarea id="templateContent" rows="8" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white border border-gray-300 dark:border-gray-600 outline-none font-mono" required></textarea>
                    </div>
                    <div class="flex justify-end gap-3">
                        <button type="button" onclick="closeEditModal()" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-4 rounded-lg transition">Cancel</button>
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition">Save Template</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="mb-4 text-center">
                    <i class="bi bi-exclamation-triangle text-red-500 text-4xl"></i>
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mt-2">Delete Template?</h3>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Are you sure you want to delete this template? This action cannot be undone.</p>
                </div>
                <div class="flex justify-center gap-3">
                    <button onclick="closeDeleteModal()" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-6 rounded-lg transition">Cancel</button>
                    <button onclick="deleteTemplate()" class="bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-lg transition">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize templates in localStorage if they don't exist
        if (!localStorage.getItem('mailTemplates')) {
            // Sample template data
            const sampleTemplates = [
                {
                    id: '1',
                    title: 'Leave Application',
                    category: 'Academic',
                    description: 'Request for leave from classes or exams',
                    content: `Subject: Application for Leave

Dear [Professor/Department Head],

I hope this email finds you well. I am writing to request leave from [class/exam] scheduled on [date] due to [reason for absence].

I understand the importance of regular attendance and will ensure that I catch up on any missed work or assignments. If there are any specific materials or tasks I should focus on during my absence, I would greatly appreciate your guidance.

Thank you for your understanding and consideration.

Sincerely,
[Your Name]
[Your Student ID]
[Your Course/Department]`
                },
                {
                    id: '2',
                    title: 'Request for Recommendation Letter',
                    category: 'Academic',
                    description: 'Email format for requesting recommendation letters from professors',
                    content: `Subject: Request for Letter of Recommendation - [Your Name]

Dear Professor [Name],

I hope this email finds you well. I am writing to request a letter of recommendation for my application to [program/scholarship/job].

I was a student in your [course name] class during [semester/year], where I received a [grade]. I particularly enjoyed [specific topic or project] and believe that my performance in your class demonstrates my abilities in [relevant skills].

The deadline for submission is [date], and I would be grateful if you could submit the letter by [date - at least 2 weeks before deadline]. I have attached my resume, statement of purpose, and [any other relevant documents] to assist you.

Please let me know if you need any additional information from me. Thank you for considering my request.

Sincerely,
[Your Name]
[Your Student ID]
[Your Contact Information]`
                },
                {
                    id: '3',
                    title: 'Fee Payment Extension',
                    category: 'Administrative',
                    description: 'Request for extension of fee payment deadline',
                    content: `Subject: Request for Fee Payment Extension

Dear Accounts Department,

I am [Your Name], a [year] year student in the [Department] with ID number [Your ID]. I am writing to request an extension for my fee payment which is currently due on [current deadline].

Due to [brief explanation of circumstances], I would like to request an extension until [proposed new deadline]. I assure you that I will be able to complete the payment by this date.

I have attached [any relevant supporting documents] for your reference. I understand that this is an exception to the regular payment schedule, and I appreciate your consideration of my request.

Thank you for your understanding.

Sincerely,
[Your Name]
[Your Student ID]
[Your Contact Information]`
                },
                {
                    id: '4',
                    title: 'Technical Issue Report',
                    category: 'IT Support',
                    description: 'Report technical issues with campus facilities',
                    content: `Subject: Technical Issue Report - [Brief Description of Issue]

Dear IT Support Team,

I am writing to report a technical issue that I am experiencing with [specific campus technology/service].

Issue Details:
- Device/Service: [Name of device or service]
- Location: [Where the issue is occurring]
- Time of Occurrence: [When the issue was first noticed]
- Description: [Detailed description of the problem]
- Steps Already Taken: [Any troubleshooting steps you've already tried]

This issue is affecting [explain the impact on your academic work]. I would greatly appreciate your assistance in resolving this matter at your earliest convenience.

I am available for further clarification or assistance in troubleshooting. You can reach me at [your contact information].

Thank you for your prompt attention to this matter.

Sincerely,
[Your Name]
[Your Student ID]`
                },
                {
                    id: '5',
                    title: 'Internship Inquiry',
                    category: 'Career',
                    description: 'Email format for inquiring about internship opportunities',
                    content: `Subject: Internship Opportunity Inquiry - [Your Name], [Your Major]

Dear [Recipient's Name],

I hope this email finds you well. My name is [Your Name], and I am currently a [year] year student pursuing [Your Degree] in [Your Major] at [Your College/University].

I am writing to inquire about potential internship opportunities at [Company/Organization Name]. I am particularly interested in [specific department or role] and believe that my academic background and skills in [relevant skills] align well with the work done at your organization.

I have attached my resume and [any other relevant documents] for your consideration. I would be grateful for the opportunity to discuss how my skills and interests could contribute to your team.

Thank you for your time and consideration. I look forward to hearing from you.

Sincerely,
[Your Name]
[Your Contact Information]
[Your LinkedIn Profile (optional)]`
                }
            ];
            
            localStorage.setItem('mailTemplates', JSON.stringify(sampleTemplates));
        }

        // Initialize local storage database if it doesn't exist
        if (!localStorage.getItem('userDatabase')) {
            localStorage.setItem('userDatabase', JSON.stringify([]));
        }

        // Load templates and check user status on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const userData = sessionStorage.getItem('currentUserData');
            if (userData) {
                const user = JSON.parse(userData);
                showHomepage(user.name);
                loadTemplates();
                loadCategories();
                checkIfAdmin(user.name);
            }
        });

        function checkIfAdmin(userName) {
            if (userName === 'Admin') {
                document.getElementById('adminControls').classList.remove('hidden');
            }
        }

        // Authentication functions
        function switchTab(tab) {
            const forms = {
                login: document.getElementById('loginForm'),
                admin: document.getElementById('adminForm'),
                register: document.getElementById('registerForm')
            };
            
            // Hide all forms
            Object.values(forms).forEach(form => form.classList.add('hidden'));
            
            // Show selected form
            forms[tab].classList.remove('hidden');
            
            // Update active tab styling
            document.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('bg-opacity-30');
            });
            document.getElementById(`${tab}Tab`).classList.add('bg-opacity-30');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Retrieve user database
            const userDatabase = JSON.parse(localStorage.getItem('userDatabase'));
            
            // Find user
            const user = userDatabase.find(user => user.email === email && user.password === password);
            
            if (user) {
                // Login successful
                showHomepage(user.name);
                loadTemplates();
                loadCategories();
                checkIfAdmin(user.name);
            } else {
                alert('Invalid email or password');
            }
        }

        function handleAdminLogin(e) {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            // Check admin password
            if (password === 'admin123') {
                // Admin login successful
                showHomepage('Admin');
                loadTemplates();
                loadCategories();
                document.getElementById('adminControls').classList.remove('hidden');
            } else {
                alert('Invalid admin password');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Check if passwords match
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            // Retrieve user database
            const userDatabase = JSON.parse(localStorage.getItem('userDatabase'));
            
            // Check if email already exists
            if(name==="admin" || name==="Admin"){
                alert('Username cannot be "admin" or "Admin"');
                
                return;
            }
            if (userDatabase.some(user => user.email === email)) {
                alert('Email already registered');
                return;
            }
            
            // Add new user
            userDatabase.push({
                name,
                email,
                password
            });
            
            // Save updated database
            localStorage.setItem('userDatabase', JSON.stringify(userDatabase));
            
            // Registration successful
            alert('Registration successful! You can now log in.');
            
            // Redirect to login
            switchTab('login');
        }

        function showHomepage(userName) {
            // Hide auth page
            document.getElementById('authPage').style.display = 'none';
            
            // Show homepage
            document.getElementById('homepage').style.display = 'block';
            
            // Set welcome message
            document.getElementById('userName').textContent = userName;
            document.getElementById('welcomeMessage').classList.remove('hidden');
            
            // Store user info in sessionStorage
            sessionStorage.setItem('currentUserData', JSON.stringify({
                name: userName,
                email: document.getElementById('loginEmail').value || 'admin@example.com'
            }));
        }

        function logout() {
            // Hide homepage
            document.getElementById('homepage').style.display = 'none';
            
            // Show auth page
            document.getElementById('authPage').style.display = 'flex';
            
            // Reset forms
            document.getElementById('loginForm').reset();
            document.getElementById('adminForm').reset();
            document.getElementById('registerForm').reset();
            
            // Switch to login tab
            switchTab('login');
            
            // Clear session storage
            sessionStorage.removeItem('currentUserData');
        }

        // Mail Templates Functions
        let currentTemplateId = null;
        let activeCategory = 'all';

        // Load templates from localStorage
function loadTemplates() {
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const container = document.getElementById('mailTemplatesContainer');
    const emptyState = document.getElementById('emptyState');
    
    // Filter templates based on active category
    const filteredTemplates = activeCategory === 'all' 
        ? templates 
        : templates.filter(template => template.category === activeCategory);
    
    // Clear container
    container.innerHTML = '';
    
    // Show empty state if no templates
    if (filteredTemplates.length === 0) {
        emptyState.classList.remove('hidden');
    } else {
        emptyState.classList.add('hidden');
        
        // Create template cards
        filteredTemplates.forEach(template => {
            const card = createTemplateCard(template);
            container.appendChild(card);
        });
    }
}

// Create template card element
function createTemplateCard(template) {
    const card = document.createElement('div');
    card.className = 'mail-template-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-sm overflow-hidden';
    card.innerHTML = `
        <div class="p-4">
            <div class="flex justify-between items-start">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">${template.title}</h3>
                <span class="inline-block bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-300 text-xs px-2 py-1 rounded-full">${template.category}</span>
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-2 line-clamp-2">${template.description}</p>
            <div class="mt-4">
                <button onclick="viewTemplate('${template.id}')" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition text-sm">
                    <i class="bi bi-envelope mr-1"></i> View Template
                </button>
            </div>
        </div>
    `;
    return card;
}

// Load categories for filter buttons
function loadCategories() {
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const container = document.getElementById('categoriesContainer');
    const categoryDropdown = document.getElementById('categoryDropdown');
    
    // Extract unique categories
    const categories = [...new Set(templates.map(template => template.category))];
    
    // Clear container (except "All" button)
    const allButton = container.firstChild;
    container.innerHTML = '';
    container.appendChild(allButton);
    
    // Clear dropdown (except default option)
    categoryDropdown.innerHTML = '<option value="">Select existing</option>';
    
    // Add category buttons
    categories.forEach(category => {
        // Add to filter buttons
        const button = document.createElement('button');
        button.className = `template-category px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium ${activeCategory === category ? 'active' : ''}`;
        button.textContent = category;
        button.onclick = () => filterTemplates(category);
        container.appendChild(button);
        
        // Add to dropdown
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categoryDropdown.appendChild(option);
    });
}

// Filter templates by category
function filterTemplates(category) {
    activeCategory = category;
    
    // Update active category button
    document.querySelectorAll('.template-category').forEach(button => {
        button.classList.remove('active');
    });
    
    event.target.classList.add('active');
    
    // Reload templates with filter
    loadTemplates();
}

// Search templates by title, category, or description
function searchTemplates() {
    const searchQuery = document.getElementById('searchInput').value.toLowerCase();
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const container = document.getElementById('mailTemplatesContainer');
    const emptyState = document.getElementById('emptyState');
    
    // Filter templates based on search and active category
    const filteredTemplates = templates.filter(template => {
        const matchesCategory = activeCategory === 'all' || template.category === activeCategory;
        const matchesSearch = 
            template.title.toLowerCase().includes(searchQuery) || 
            template.category.toLowerCase().includes(searchQuery) || 
            template.description.toLowerCase().includes(searchQuery);
        
        return matchesCategory && matchesSearch;
    });
    
    // Clear container
    container.innerHTML = '';
    
    // Show empty state if no templates
    if (filteredTemplates.length === 0) {
        emptyState.classList.remove('hidden');
    } else {
        emptyState.classList.add('hidden');
        
        // Create template cards
        filteredTemplates.forEach(template => {
            const card = createTemplateCard(template);
            container.appendChild(card);
        });
    }
}

// View template details
function viewTemplate(id) {
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const template = templates.find(template => template.id === id);
    
    if (template) {
        currentTemplateId = id;
        
        // Set modal content
        document.getElementById('viewTemplateTitle').textContent = template.title;
        document.getElementById('viewTemplateCategory').textContent = template.category;
        document.getElementById('viewTemplateDescription').textContent = template.description;
        document.getElementById('viewTemplateContent').textContent = template.content;
        
        // Show admin controls if user is admin
        const userData = JSON.parse(sessionStorage.getItem('currentUserData') || '{}');
        if (userData.name === 'Admin') {
            document.getElementById('viewTemplateAdminControls').classList.remove('hidden');
        } else {
            document.getElementById('viewTemplateAdminControls').classList.add('hidden');
        }
        
        // Show modal
        document.getElementById('viewTemplateModal').classList.remove('hidden');
    }
}

// Close view modal
function closeViewModal() {
    document.getElementById('viewTemplateModal').classList.add('hidden');
}

// Show add template modal
function showAddTemplateModal() {
    // Reset form
    document.getElementById('templateForm').reset();
    document.getElementById('templateId').value = '';
    document.getElementById('editModalTitle').textContent = 'Add New Template';
    
    // Show modal
    document.getElementById('editTemplateModal').classList.remove('hidden');
}

// Show edit template modal
function showEditModal() {
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const template = templates.find(template => template.id === currentTemplateId);
    
    if (template) {
        // Set form values
        document.getElementById('templateId').value = template.id;
        document.getElementById('templateTitle').value = template.title;
        document.getElementById('templateCategory').value = template.category;
        document.getElementById('templateDescription').value = template.description;
        document.getElementById('templateContent').value = template.content;
        
        // Set modal title
        document.getElementById('editModalTitle').textContent = 'Edit Template';
        
        // Close view modal
        closeViewModal();
        
        // Show edit modal
        document.getElementById('editTemplateModal').classList.remove('hidden');
    }
}

// Close edit modal
function closeEditModal() {
    document.getElementById('editTemplateModal').classList.add('hidden');
}

// Save template (add or edit)
function saveTemplate(event) {
    event.preventDefault();
    
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const id = document.getElementById('templateId').value;
    
    const templateData = {
        title: document.getElementById('templateTitle').value,
        category: document.getElementById('templateCategory').value,
        description: document.getElementById('templateDescription').value,
        content: document.getElementById('templateContent').value
    };
    
    if (id) {
        // Edit existing template
        const index = templates.findIndex(template => template.id === id);
        if (index !== -1) {
            templateData.id = id;
            templates[index] = templateData;
        }
    } else {
        // Add new template
        templateData.id = Date.now().toString();
        templates.push(templateData);
    }
    
    // Save to localStorage
    localStorage.setItem('mailTemplates', JSON.stringify(templates));
    
    // Close modal
    closeEditModal();
    
    // Reload templates
    loadTemplates();
    loadCategories();
    
    // Show success message
    alert(id ? 'Template updated successfully!' : 'Template added successfully!');
}

// Select existing category from dropdown
function selectExistingCategory() {
    const selectedCategory = document.getElementById('categoryDropdown').value;
    if (selectedCategory) {
        document.getElementById('templateCategory').value = selectedCategory;
    }
}

// Show delete confirmation modal
function confirmDelete() {
    document.getElementById('deleteConfirmModal').classList.remove('hidden');
}

// Close delete modal
function closeDeleteModal() {
    document.getElementById('deleteConfirmModal').classList.add('hidden');
}

// Delete template
function deleteTemplate() {
    const templates = JSON.parse(localStorage.getItem('mailTemplates')) || [];
    const updatedTemplates = templates.filter(template => template.id !== currentTemplateId);
    
    // Save to localStorage
    localStorage.setItem('mailTemplates', JSON.stringify(updatedTemplates));
    
    // Close modals
    closeDeleteModal();
    closeViewModal();
    
    // Reload templates
    loadTemplates();
    loadCategories();
    
    // Show success message
    alert('Template deleted successfully!');
}
    
        </script>
        </body>
        </html>